{
  "kind": "build_request",
  "title": "Fix backend actor availability issue preventing case creation",
  "projectName": "Liver Surgery Log",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Diagnose and fix the backend actor initialization issue that prevents the actor from being available when users attempt to add cases through the web interface",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "unable to add case in liver app web page; backend actor not available"
        ]
      },
      "acceptanceCriteria": [
        "Backend actor successfully initializes and becomes available after login",
        "Users can create new cases without encountering 'actor not available' errors",
        "Actor connection is maintained throughout the user session"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Verify that the useActor hook properly recreates the actor instance when the Internet Identity authentication state changes",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Actor is recreated immediately after successful authentication",
        "React Query cache is properly invalidated when actor changes",
        "No race conditions occur between authentication and actor initialization"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add error boundary and user-friendly error messaging for backend actor connection failures with retry mechanism",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Clear error message displays when backend actor is unavailable",
        "Users can trigger a manual retry to reconnect to the backend",
        "Loading states accurately reflect actor initialization status"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Ensure the CaseFormDialog component properly waits for actor availability before attempting to create cases",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Form submission is disabled when actor is unavailable",
        "Form displays loading or disabled state during actor initialization",
        "Case creation mutation only executes when actor is confirmed available"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture in backend/main.mo",
    "Do not modify immutable frontend paths: useInternetIdentity.ts, useActor.ts, main.tsx, components/ui",
    "Preserve existing authentication flow using Internet Identity"
  ],
  "nonGoals": [
    "Implementing alternative authentication methods",
    "Restructuring the backend into multiple actors",
    "Adding offline functionality or service worker caching for mutations"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}